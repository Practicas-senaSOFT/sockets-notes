<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOTES</title>
    <style>
        ul {list-style-type: node;margin: 0;padding: 0;}
        ul > li {padding: 0.5rem 1rem;}
        ul > li.host{
            background-color: rgb(187, 214, 250);
            text-align: right;
            font-style: italic;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>APP - NOTES</h1>
    <ul id="notes"></ul>
    <form id="noteForm" action="" style="background-color: rgb(143, 187, 228);text-align: center;">
      <input id="title" type="text" placeholder="Title">
      <textarea id="description" rows="3" placeholder="Description"></textarea>
      <button type="submit">Send</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <!-- <script src="./main.js" type="module"></script> -->
    

    <script>

      let socket = io('http://localhost:3000/chat');
      // let socket2 = io('http://localhost:3000/home');
      // let currentsid;
      socket.on('connect', () => {
        console.log('ID:: ',socket.id);
        currentsid = socket.id;
      });

      const notesList = document.querySelector('#notes');
      let notes;
      //!Obtenemos las notas
      socket.on('server:note:load', async (data)=>{
        // notes.push(data);
        notes = data
        console.table(notes);
        renderNotes(notes);
      });
      //Obtenemos la nota recien creada
      socket.on('server:note:new', (note)=>{
        appendNote(note);
      });
      //Rederisamos las notas obtenidas
      const renderNotes = (notes) =>{
        notes.forEach(note => notesList.append(noteUi(note)));
      };
      //Agregar todas las notas
      const noteUi = (note) =>{
        const div = document.createElement('dev')
        div.innerHTML = `
          <div>
            <h1>${note.title}</h1>
            <p>${note.description}</p>
            <button>Update</button>
            <button>Delete</button>
          </div>`
        return div;
      };
      //Agregar solo una nota, la que se crea
      const appendNote = (note) => {
        notesList.append(noteUi(note));
      };

      const noteForm = document.querySelector('#noteForm')
      noteForm.addEventListener('submit', (event)=>{
        event.preventDefault();
        console.log('SUBMIT');

        const title = noteForm['title'].value;
        const description = noteForm['description'].value;
        //Enviamos los datos
        socket.emit('client:note:create',{title,description})
      });

      //Gestor de envio - enviar datos
      // const onHandlerSubmit = (event)=>{
      //   event.preventDefault();
      //   console.log('SUBMIT');

      //   const title = noteForm['title'].value;
      //   const description = noteForm['description'].value;
      //   //Enviamos los datos
      //   socket.emit('note:create',{title,description})
      //   console.log(
      //     `Title: ${title}\nDescription: ${description}`
      //   );
      // }

    </script>

</body>
</html>